---
title: "Weaponizing Apache OFBiz CVE-2023-51467 - Blog - VulnCheck"
date: 2024-01-11T00:00:00.000Z
draft: false
type: posts
categories: 
- 
---
# Weaponizing Apache OFBiz CVE-2023-51467 - Blog - VulnCheck

<br/>

<br/>
::check-list\\n---\\ntitle: Key Takeaways\\nico: mdi:check-bold\\nlist:\\n - VulnCheck developed and open-sourced a memory-resident payload for Apache OFBiz’s CVE-2023-51467.\\n - The Apache OFBiz Groovy “Sandbox” is trivially bypassable.\\n - There are only hundreds of vulnerable internet-facing Apache OFBiz installations.\\n---\\n::\\n\\n## Introduction\\n\\nOn December 26, \[SonicWall\](https://blog.sonicwall.com/en-us/2023/12/sonicwall-discovers-critical-apache-ofbiz-zero-day-authbiz/) disclosed an authentication bypass affecting Apache OFBiz. SonicWall demonstrated the vulnerability, assigned \[CVE-2023-51467\](https://nvd.nist.gov/vuln/detail/CVE-2023-51467), by accessing the protected HTTP endpoint \`/webtools/control/ping\` without authentication. While that proved the vulnerability existed, it did not demonstrate arbitrary code execution. However, CVE-2023-51467 can be used to execute arbitrary code. And even better, it can be used to execute a payload from memory. In this blog, we’ll demonstrate how we weaponized Apache OFBiz CVE-2023-51467.\\n\\n## Does OFBiz Matter?\\n\\nApache OFBiz is not hugely popular software. There are approximately 500-1000 internet-facing targets at any given time. A naive search on Shodan indicates there are more than 10,000 targets.\\n\\n!\[OFBiz on Shodan\](/blog/ofbiz-cve-2023-51467/shodan-honeypots.png){:width="100%"}\\n\\nBut it turns out that almost all of these are honeypots. In fact, looking at Shodan’s trends, we see a huge spike of honeypots in September 2023.\\n\\n!\[OFBiz honeypot trend on Shodan\](/blog/ofbiz-cve-2023-51467/shodan-ofbiz-trend.png){:width="100%"}\\n\\nThis likely suggests that the software is interesting to defenders and attackers alike. Historically, OFBiz has been an exploitation target. The Syssrv botnet was \[reported\](https://cujo.com/blog/the-sysrv-botnet-and-how-it-evolved/) to exploit \[CVE-2020-9496\](https://nvd.nist.gov/vuln/detail/CVE-2020-9496), and \[CVE-2021-29200\](https://nvd.nist.gov/vuln/detail/CVE-2021-29200) has activity on \[GreyNoise\](https://viz.greynoise.io/tag/apache-ofbiz-deserialization-rce-attempt?days=1). OFBiz was also one of the first products to have a public Log4Shell \[exploit\](https://attackerkb.com/topics/in9sPR2Bzt/cve-2021-44228-log4shell/rapid7-analysis). \\n\\n## Finding an RCE Sink\\n\\nAll that is to say, OFBiz has been exploited in the past, and it will be exploited in the future when the opportunity arises. This is why it only took a few days after the SonicWall disclosure for a couple of Chinese language blogs to suggest a \[code execution endpoint\](https://y4tacker.github.io/2023/12/27/year/2023/12/Apache-OFBiz%E6%9C%AA%E6%8E%88%E6%9D%83%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%B5%85%E6%9E%90-CVE-2023-51467/), and provide a \[proof of concept\](https://xz.aliyun.com/t/13211) for command execution. The following image is from \[RacerZ’s\](https://xz.aliyun.com/u/61082) blog:\\n\\n!\[RacerZ proof of concept exploit for CVE-2023-51467\](/blog/ofbiz-cve-2023-51467/og-poc.png){:width="100%"}\\n\\nAs you can see, RacerZ was able to pop calc using the \`/webtools/control/ProgramExport\` endpoint alongside the authentication bypass (CVE-2023-51467). This endpoint executes \[Groovy\](https://groovy-lang.org/) code provided by authenticated users. However, the endpoint is not intended to execute arbitrary Groovy. The code is passed through a blocklist of unacceptable values (which we’ll examine later). OFBiz developers appear to refer to this as a \[sandbox\](https://issues.apache.org/jira/browse/OFBIZ-12305), although that’s being a little liberal with the term. Either way, this “sandbox” is intended to prevent the uploading of webshells and other nefarious activities. This is, perhaps, why (before this blog) we haven’t seen a reverse shell or real weaponized exploit for this yet. Maybe the “sandbox” does its job?\\n\\n## The Groovy “Sandbox”\\n\\nThe “sandbox” blocks the \[following strings\](https://github.com/apache/ofbiz-framework/blob/9bd538be3eef75eba33ae1c40e88ba7f90b2bdce/framework/security/config/security.properties#L274) from being included in the Groovy sent to \`/webtools/control/ProgramExport\`:\\n\\n\`\`\`\\njava.\\nbeans\\nfreemarker\\nwhoami\\nwhoami\\nalbinolobst9bd8\\albinolobster\\n\`\`\`\\n\\nOf course, executing \`whoami\` spawns cmd.exe and, if you believe Twitter, will cause the EDR teams to come running. \\n\\n!\[whoami generated by Nashorn\](/blog/ofbiz-cve-2023-51467/process-spawn.png){:width="100%"}\\n\\nBut it’s still better than dropping Meterpreter on disk. That’ll only make Defender (or whoever) mad. \\n\\nOn the wire, this exploit is not subtle.\\n\\n!\[Exploit on the wire\](/blog/ofbiz-cve-2023-51467/cve-2023-51467-wireshark.png){:width="100%"}\\n\\nIt does have one thing going for it, though: OFBiz installs typically use TLS so unless someone is decrypting the traffic, network detections are far less of a concern.\\n\\n## Conclusion\\n\\nOFBiz is not widely popular, but it has been exploited in the past. There is a fair deal of hype around CVE-2023-51467 but no public weaponized payload, which called into question if it was even possible. We’ve concluded that not only is it possible, but we can achieve arbitrary in memory code execution. VulnCheck has \[shared\](https://github.com/vulncheck-oss/cve-2023-51467) a public exploit that will hopefully aid defenders in diagnosing what \*real\* attacks look like.\\n\\n## About VulnCheck\\n\\nThe VulnCheck Initial Access team is always looking to advance the state of attack on initial access vulnerabilities like CVE-2023-51467. For more research like this, see our blogs, \[PaperCut Exploitation\](https://vulncheck.com/blog/papercut-rce), \[Fileless Remote Code Execution on Juniper Firewalls\\n\](https://vulncheck.com/blog/juniper-cve-2023-36845), and \[Executing from Memory Using ActiveMQ CVE-2023-46604\](https://vulncheck.com/blog/cve-2023-44604-activemq-in-memory). Sign up to start a trial of our \[Initial Access Intelligence\](https://vulncheck.com/product/initial-access-intelligence) and \[Exploit & Vulnerability Intelligence\](https://vulncheck.com/product/exploit-intelligence) product today.\\n

#### [Source](https://vulncheck.com/blog/ofbiz-cve-2023-51467)

<br/>
---
