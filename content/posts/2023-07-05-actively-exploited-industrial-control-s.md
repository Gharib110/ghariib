---
title: "Actively Exploited Industrial Control Systems Hardware - SolarView Series - Blog - VulnCheck"
date: 2023-07-05T00:00:00.000Z
draft: false
type: posts
categories: 
- 
---
# Actively Exploited Industrial Control Systems Hardware - SolarView Series - Blog - VulnCheck

<br/>

<br/>
On June 22, 2023, Palo Alto Networks Unit 42 published \*\[IoT Under Siege: The Anatomy of the Latest Mirai Campaign Leveraging Multiple IoT Exploits\](https://unit42.paloaltonetworks.com/mirai-variant-targets-iot-exploits/)\*. The blog discusses a Mirai botnet variant using a handful of "new" CVEs to propagate. \\n\\n\\nOne of the vulnerabilities was \[CVE-2022-29303\](https://nvd.nist.gov/vuln/detail/CVE-2022-29303). CVE-2022-29303 is an unauthenticated and remote command injection vulnerability affecting the \[Contec SolarView Series\](https://www.contec.com/products-services/environmental-monitoring/solarview/). Since VulnCheck \[Exploit Intelligence\](https://vulncheck.com/product/exploit-intelligence) has indexed a number of public exploits for SolarView, we decided to dig in and examine the potential scale and impact of this exploitation in the wild.\\n\\nTo understand the potential impact, we first need to know what Contec SolarView is. SolarView monitors and visualizes small to medium-scale solar power generation and storage. Contec’s website \[advertises\](https://www.contec.com/solutions/energy/) that the “SolarView brand … has been introduced at more than 30,000 power stations.” It also highlights deployment scenarios for \[SolarView Air\](https://www.contec.com/solutions/energy/solutions/solar-power/) and \[SolarView Battery\](https://www.contec.com/solutions/energy/solutions/solar-battery/) that depict the hardware being used in commercial buildings and solar power plants. Contec SolarView is clearly intended for ICS networks, so you’d hope to never find one accessible over the internet.\\n\\nShodan currently indexes more than 600 SolarView systems.\\n\\n!\[SolarView instances on Shodan\](/blog/solarview-exploitation/solarview-shodan.png){:width="100%"}\\n\\nPalo Alto Networks’ recent blog touches on the Mirai-variant abusing CVE-2022-29303. According to the CVE description, the affected versions of SolarView are “ver.6.00”. Version 6.00 was released in 2019, and SolarView Compact has seen four firmware releases since then (6.20 in 2019, 7.00 in 2021, 8.00 in 2022, and 8.10 in 2023). That suggests that only a small subset of internet-facing hosts are likely to be vulnerable. However, further examination of SolarView’s firmware revealed that this CVE description is inaccurate.\\n\\nCVE-2022-29303 affects the web server’s \`conf\_mail.php\` endpoint, but version 6.20 (the version following the reportedly vulnerable 6.00) didn’t implement a fix for the issue. Not only was version 6.00 affected, but 6.20 as well. In fact, we found that the very straight-forward command injection in \`conf\_mail.php\` has existed since \*at least\* version 4.00:\\n\\n\`\`\`php\\nif( isset($\_REQUEST\['button'\]) ){\\n $button = $\_REQUEST\['button'\];\\n $mail\_address = $\_REQUEST\['mail\_address'\];\\n}\\ninclude("include/ShowMsg.func");\\ninclude("include/common.def");\\n$TestMailLog = "/var/log/SMail\_test.log";\\n$CONFFILE = $ConfDataDir."/fws\_mail.conf";\\n\\nif( $button == $LABEL\_SENDEXEC ){\\n $mail\_address = str\_replace( " ","", $mail\_address );\\n if( strlen($mail\_address) > 3 ){\\n $sendmes = "SolarView";\\n $exec\_cmd = "echo -1 ".$mail\_address." TEST-MAIL '$sendmes' > /dev/elogparam";\\n system( $exec\_cmd );\\n $status = 2;\\n }\\n else{\\n $status = 3;\\n }\\n}\\n\`\`\`\\n\\nIt wasn’t until version 8.00 that \`conf\_mail.php\` was added to the \`auth.require\` list, and validation is added to the attacker-controlled \`$mail\_address\` variable.\\n\\n\`\`\`php\\nif( isset($\_REQUEST\['button'\]) ){\\n $button = $\_REQUEST\['button'\];\\n $mail\_address = EscStr($\_REQUEST\['mail\_address'\]);\\n $mail\_address = str\_replace(" ","",$mail\_address);\\n $address\_array = explode(",", $mail\_address);\\n $mail\_address = "";\\n $cnt = 0;\\n for( $i = 0 ; $i < sizeof($address\_array) ; $i++ ){\\n if( filter\_var($address\_array\[$i\], FILTER\_VALIDATE\_EMAIL) ){\\n if( $cnt == 0 ){\\n $mail\_address = $address\_array\[$i\];\\n }\\n else{\\n $mail\_address .= ",".$address\_array\[$i\];\\n }\\n $cnt++;\\n }\\n }\\n}\\n\`\`\`\\n\\nSuffice to say, the range of affected systems is much wider than the CVE description lets on, and thanks to a copyright string on the landing page (and the sparse amount of releases over the years), we can easily fingerprint the affected internet-facing systems.\\n\\n!\[Vulnerable SolarView instances on Shodan\](/blog/solarview-exploitation/shodan-affected.png){:width="100%"}\\n\\nIt turns out that less than one third of the internet-facing SolarView series systems are patched against CVE-2022-29303. \\n\\nAdditionally, Unit 42’s blog wasn’t even the first indication that the vulnerability was being exploited in the wild. CVE-2022-29303 has had an \[Exploit-DB entry\](https://www.exploit-db.com/exploits/50940) since May 2022. GreyNoise \[mentioned\](https://www.greynoise.io/blog/trinity-cyber-sharing-intelligence-protect-internet-citizens) the vulnerability in a blog in May 2023. And a \[YouTube video\](https://www.youtube.com/watch?v=vFo1XETreCs) from May 2022 shows an attacker using the Exploit-DB exploit against a SolarView system found on Shodan (why one would post their crimes to YouTube, I’ll never know).\\n\\n\\n!\[Exploitation of SolarView on YouTube\](/blog/solarview-exploitation/youtube-crimes.png){:width="100%"}\\n\\nIt gets worse. While CVE-2022-29303 has garnered attention from some organizations like Unit 42 and GreyNoise, there are a couple of other unauthenticated RCEs affecting the systems that have not.\\n\\nFor example, \[CVE-2023-23333\](https://nvd.nist.gov/vuln/detail/CVE-2023-23333) affects the SolarView series up to version 8.00 (despite the fact that the CVE description says “through 6.0”). This vulnerability doesn’t have any Exploit-DB entries, but it has \[multiple\](https://github.com/Timorlover/CVE-2023-23333) \[exploits\](https://github.com/Mr-xn/CVE-2023-23333) on \[GitHub\](https://github.com/WhiteOwl-Pub/PoC-SolarView-Compact-CVE-2023-23333).\\n\\n!\[downloader.php exploit\](/blog/solarview-exploitation/downloader-exploit.png){:width="100%"}\\n\\nCVE-2023-23333 is a simple command injection affecting the \`downloader.php\` endpoint (specifically mishandling of user data in the \`zip\` case).\\n\\n\`\`\`php\\nif( isset($\_REQUEST\['file'\]) ){\\n $file = $\_REQUEST\['file'\];\\n}\\nfunction get\_extend( $filename ){\\n $pos = strrpos( $filename, "." );\\n return substr( $filename, $pos );\\n}\\n$ext = get\_extend( $file );\\nswitch( $ext ){\\ncase ".csv":\\n break;\\ncase ".jpg":\\ncase ".jpeg":\\ncase ".JPG":\\ncase ".JPEG":\\ncase ".Jpeg":\\ncase ".Jpg":\\ncase ".gif":\\ncase ".GIF":\\ncase ".Gif":\\n $path = "/home/www/html/images/";\\n break;\\ncase ".zip":\\n $ARCH\_FILE = sprintf("/home/contec/data/%s", $file);\\n if( file\_exists($ARCH\_FILE) ){\\n unlink($ARCH\_FILE);\\n }\\n $cmd = sprintf("/usr/local/bin/data\_zip.sh %s > /dev/null", basename($ARCH\_FILE));\\n system($cmd);\\n $file = $ARCH\_FILE;\\n break;\\n}\\n\`\`\`\\n\\nThe SolarView Series is also affected by \[CVE-2022-44354\](https://nvd.nist.gov/vuln/detail/CVE-2022-44354), a file upload vulnerability that allows an attacker to \[upload\](https://github.com/strik3r0x1/Vulns/blob/main/Unrestricted%20File%20Upload\_%20SolarView%20Compact%204.0%2C5.0.md) a PHP webshell to the system. The CVE description says “Compact 4.0 and 5.0” are affected, but there’s a duplicate CVE (\[CVE-2022-31374\](https://nvd.nist.gov/vuln/detail/CVE-2022-31374)) that says Compact 6.0 is affected. Either way, we see no changes to \`/Solar\_Image.php\` (the affected component) until version 7.0.\\n\\n\`\`\`php\\n- else if( $img\_type < 0 || 3 < $img\_type ){\\n+ else if( $img\_type <= 0 || 3 < $img\_type ){\\n echo "JPEG”;\\n }\\n else{\\n- copy( $userfile, $IMG\_PATH."/".basename($userfile\_name));\\n- echo urldecode($userfile\_name)."  
\\n";\\n- chmod( $IMG\_PATH."/".basename($userfile\_name), 0666 );\\n- echo $MSG\_SEND\_OK."\\n";\\n+ $cmd = sprintf("/usr/bin/file %s | awk '{print $2}'",$userfile );\\n+ $img\_type = exec( $cmd);\\n+ if( $img\_type == "GIF" || $img\_type == "PNG" || $img\_type == "JPG" || $img\_type == "JPEG" ){\\n+ copy( $userfile, $IMG\_PATH."/".basename($userfile\_name));\\n+ echo urldecode($userfile\_name)."  
\\n";\\n+ chmod( $IMG\_PATH."/".basename($userfile\_name), 0666 );\\n+ echo $MSG\_SEND\_OK."\\n";\\n+ }\\n\`\`\`\\n\\nThe changes in version 7.00 are trivially bypassed by appending the webshell to a valid image. SolarView version 8.00 adds \`/Solar\_Image.php\` to the \`auth.require\` list, which at least makes this an authenticated issue now.\\n\\nBoth the \`/Solar\_Image.php\` and \`/downloader.php\` endpoints appear to generate hits from malicious hosts on GreyNoise meaning that they too are likely under some level of active exploitation.\\n\\n!\[SolarView Exploitation on GreyNoise\](/blog/solarview-exploitation/solarview-exploitation-greynoise.png){:width="100%"}\\n\\nFinally, it’s worth noting that these issues are not isolated to the SolarView “Compact” hardware version. The “Air” is also affected (the code is nearly identical) and, likely, the “Battery” hardware version is affected as well.\\n\\n# Conclusion\\n\\nWe’ve looked at a few critical CVEs that affect the SolarView series and determined that there are a few hundred internet-facing systems that remain affected by these issues. When considered in isolation, exploitation of this system is not significant. The SolarView series are all monitoring systems, so loss of view (\[T0829\](https://attack.mitre.org/techniques/T0829/)) is likely the worst-case scenario.However, the impact of exploitation \*could\* be high impact depending on the network the SolarView hardware is integrated into. \\n\\nFor instance, if the hardware is part of a solar power generation site, then the attacker may affect loss of productivity and revenue (\[T0828\](https://attack.mitre.org/techniques/T0828/)) by using the hardware as a network pivot to attack other ICS resources.\\n\\nThe fact that a number of these systems are internet facing and that the public exploits have been available long enough to get rolled into a Mirai-variant is not a good situation. As always, organizations should be mindful of which systems appear in their public IP space and track public exploits for systems that they rely on.\\n\\n\\n# Sign Up\\n\\nFor more information on vulnerabilities exploited in the wild, register for a VulnCheck account today by loading https://vulncheck.com and clicking “Log In”.\\n

#### [Source](https://vulncheck.com/blog/solarview-exploitation)

<br/>
---
