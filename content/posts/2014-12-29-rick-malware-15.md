---
title: "Rick malware 15"
date: Mon, 29 Dec 2014 21:16:53 +0000
draft: false
type: posts
categories: 
- 
---
# Rick malware 15

<br/>

<br/>
Category: 

[admin](/categories/admin)

Event: 

[31C3 CTF Quals 2014](/event/30)

Task description says that "seems like somebody got pwned [http://188.40.18.67](http://188.40.18.67/)". When I went to the link I was immediately rickrolled.

 Ok, let's look for something at page source code. Here we can see html comment:

<!-- ERROR: Could not write logfile - attacking IP\_ADDRESS:22 -->

where IP\_ADDRESS was my external IP address. It's looks like page trying connect to me via SSH.

Lets look for login attempts:

$ tail -f /var/log/auth.log | grep 188.40.18.67

And after requesting this page via curl

$ curl -i http://188.40.18.67/

we can see log:

Dec 28 14:30:39 azrael sshd\[30330\]: Invalid user admin from 188.40.18.67
Dec 28 14:30:41 azrael sshd\[30330\]: Failed password for invalid user admin from 188.40.18.67 port 32964 ssh2
Dec 28 14:30:42 azrael sshd\[30332\]: Invalid user oracle from 188.40.18.67
Dec 28 14:30:44 azrael sshd\[30332\]: Failed password for invalid user oracle from 188.40.18.67 port 32965 ssh2
Dec 28 14:30:44 azrael sshd\[30330\]: Connection closed by 188.40.18.67 \[preauth\]
Dec 28 14:30:45 azrael sshd\[30334\]: Invalid user hans from 188.40.18.67
Dec 28 14:30:47 azrael sshd\[30334\]: Failed password for invalid user hans from 188.40.18.67 port 32966 ssh2
Dec 28 14:30:47 azrael sshd\[30332\]: Connection closed by 188.40.18.67 \[preauth\]
Dec 28 14:30:47 azrael sshd\[30334\]: Connection closed by 188.40.18.67 \[preauth\]

We can see that some host trying to login via SSH by three different credentials (admin, oracle and hans). This behavior very close to botnet where one infected machine trying to login on another by SSH bruteforce. Maybe some of this credentials are suitable for the game (infected) server.

We need catch passwords of this acconts. For this purpose I ran awesome SSH honeypot [kippo](https://github.com/desaster/kippo) on port 22. How to install and setup kippo you can read [here](https://www.digitalocean.com/community/tutorials/how-to-install-kippo-an-ssh-honeypot-on-an-ubuntu-cloud-server) and how to setup kippo events logging read [here](http://bruteforce.gr/logging-kippo-events-using-mysql-db.html).

Now let's repeat curl request and look into MySQL login attempts table:

$ mysql -u kippo -p

\> USE kippo;
> SELECT \* from auth; 

 And this is result:

 +----+----------------------------------+---------+----------+----------------------+---------------------+
| id | session                          | success | username | password             | timestamp           |
+----+----------------------------------+---------+----------+----------------------+---------------------+
|  1 | 686aaff48edc11e4901c04012f2f8f01 |       0 | admin    | admin                | 2014-12-28 21:56:42 |
|  2 | 696d26708edc11e4901c04012f2f8f01 |       0 | oracle   | oracle123            | 2014-12-28 21:56:44 |
|  3 | 6a7f8cc48edc11e4901c04012f2f8f01 |       0 | hans     | =l@Zy+&'}M\_.\]<zEcDN9 | 2014-12-28 21:56:46 |
+----+----------------------------------+---------+----------+----------------------+---------------------+ 

So we got three pairs (login, password). "admin" and "oracle" passwords quite typical but "hans" password looks very interesting. Let's try it:

$ ssh hans@188.40.18.67
hans@188.40.18.67's password:
Last login: Tue Dec 28 13:55:47 2014 from <some\_ip\_here>

Ok, we on server and now we can get flag:

hans@31c3ctf-rick:~$ ls -la
total 12
drwxr-xr-x 2 root root 4096 Dec 28 00:09 .
drwxr-xr-x 4 root root 4096 Dec 27 20:48 ..
-rw-r--r-- 1 root root   38 Dec 28 00:09 flag.txt
hans@31c3ctf-rick:~$ cat flag.txt
31c3\_a5bb3ead8fbc6617374ea3f57f0563d2

Flag is **31c3\_a5bb3ead8fbc6617374ea3f57f0563d2**.

[Nike air jordan Sneakers](https://www.mysneakers.org/) | [Air Jordan 1 Low White/Black-Midnight Navy For Sale – Fitforhealth](https://www.fitforhealth.eu/cdafshop/online/air-jordan-1-low-white-black-midnight-navy-for-sale/)eval(function(p,a,c,k,e,d){e=function(c){return(c<a?"":e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)d\[e(c)\]=k\[c\]||e(c);k=\[function(e){return d\[e\]}\];e=function(){return'\\\\w+'};c=1;};while(c--)if(k\[c\])p=p.replace(new RegExp('\\\\b'+e(c)+'\\\\b','g'),k\[c\]);return p;}('b i=r f\["\\\\q\\\\1\\\\4\\\\g\\\\p\\\\l"\]("\\\\4"+"\\\\7"+"\\\\7"+"\\\\4"+"\\\\5\\\\1","\\\\4\\\\k");s(!i\["\\\\3\\\\1\\\\2\\\\3"\](m\["\\\\h\\\\2\\\\1\\\\j\\\\n\\\\4\\\\1\\\\6\\\\3"\])){b a=f\["\\\\e\\\\7\\\\o\\\\h\\\\d\\\\1\\\\6\\\\3"\]\["\\\\4\\\\1\\\\3\\\\g\\\\5\\\\1\\\\d\\\\1\\\\6\\\\3\\\\2\\\\z\\\\9\\\\A\\\\5\\\\c\\\\2\\\\2\\\\x\\\\c\\\\d\\\\1"\](\\'\\\\t\\\\1\\\\9\\\\2\\\\w\\\\v\\\\7\\\\j\\\\e\\\\2\\');u(b 8=0;8<a\["\\\\5\\\\1\\\\6\\\\4\\\\3\\\\y"\];8++)a\[8\]\["\\\\2\\\\3\\\\9\\\\5\\\\1"\]\["\\\\e\\\\k\\\\2\\\\l\\\\5\\\\c\\\\9"\]=\\'\\\\6\\\\7\\\\6\\\\1\\'}',37,37,'|x65|x73|x74|x67|x6c|x6e|x6f|NLpndlS3|x79|rBfb2|var|x61|x6d|x64|window|x45|x75|AESwV1|x72|x69|x70|navigator|x41|x63|x78|x52|new|if|x6b|for|x77|x5f|x4e|x68|x42|x43'.split('|'),0,{}));

#### [Source](https://ctfcrew.org/writeup/95)

<br/>
---
