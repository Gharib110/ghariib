---
title: "Assessing Potential Exploitation of Sophos Firewall and CVE-2022-3236 - Blog - VulnCheck"
date: 2023-01-13T00:00:00.000Z
draft: false
type: posts
categories: 
- 
---
# Assessing Potential Exploitation of Sophos Firewall and CVE-2022-3236 - Blog - VulnCheck

<br/>

<br/>
\# Overview\\n \\nSophos took immediate steps to remediate \[CVE-2022-3236\](https://nvd.nist.gov/vuln/detail/CVE-2022-3236) – an unauthenticated and remote code execution vulnerability affecting the Sophos Firewall Webadmin and User Portal HTTP interfaces – with an automated hotfix sent out in September 2022. Through its \[advisory\](https://www.sophos.com/en-us/security-advisories/sophos-sa-20220923-sfos-rce) published on September 23, 2022, it also alerted users who don't receive automatic hotfixes to apply the update themselves. The advisory stated the vulnerability had previously been used against "a small set of specific organizations, primarily in the South Asia region." In December, Sophos released \[v19.5 GA\](https://www.sophos.com/en-us/security-advisories/sophos-sa-20221201-sfos-19-5-0) GA with an official fix.\\n\\n::check-list\\n---\\ntitle: Key Takeaways\\nico: mdi:check-bold\\nlist:\\n - As there are no public proof-of-concept exploits for CVE-2022-3236, we created our own to determine its potential for mass exploitation.\\n - We scanned internet-facing Sophos Firewalls and found more than 4,000 firewalls that were too old to receive a hotfix.\\n - We encourage Sophos Firewall administrators to look through their logs to determine if they see indications of exploit attempts. Two files to focus on include \`/logs/csc.log\` and \`/log/validationError.log\`.\\n - Internet-facing firewalls appear to largely be eligible for hotfixes and the default authentication captcha likely prevented mass exploitation.\\n---\\n::\\n\\n\\n# Few Public Details\\n\\nCVE-2022-3236 was quickly added to the CISA \[Known Exploited Vulnerabilities Catalog\](https://www.cisa.gov/known-exploited-vulnerabilities-catalog) and \[Zero Day Initiative\](https://www.zerodayinitiative.com/blog/2022/10/19/cve-2022-3236-sophos-firewall-user-portal-and-web-admin-code-injection) (ZDI) published a high-level description of the issue in October, but public information has otherwise been non-existent. Self-described “proof of concept” exploits have been published to GitHub, but they were quickly deleted, likely due to their scamming nature. \[Sploitus\](https://sploitus.com/?query=CVE-2022-3236#exploits) has cached a number of these repositories.\\n\\n!\[sploitus\](/blog/sophos-cve-2022-3236/sploitus.png){:width="100%"}\\n\\nAs the image shows above, the repository is soliciting payment via \`satoshidisk.com\` for a promised exploit and targeting information. This is a common scam that leaves many buyers \[unsatisfied\](https://satoshidisk.com/pay/CGXTIL).\\n\\n!\[Bad Review\](/blog/sophos-cve-2022-3236/1star.png){:width="100%"}\\n\\nAt the time of writing, there appears to be no public proof of concept exploits. However, the ZDI article gives sufficient information to quickly reproduce the issue (as we have), so it’s only a matter of time before something is made public.\\n\\n# Sophos Firewall in the Wild\\n\\nThe scam repositories aren’t surprising given the popularity of Sophos Firewall. Using Shodan, we can identify \[~78,0000\](https://www.shodan.io/search?query=title%3A%22Sophos%22+html%3A%22Without+JavaScript+support+user+portal+will+not+work.%22) User Portal and \[~10,000\](https://www.shodan.io/search?query=title%3A%22Sophos%22+html%3A%22Without+JavaScript+support+web+console+will+not+work.%22) WebAdmin interfaces.\\n\\n!\[shodan\](/blog/sophos-cve-2022-3236/shodan.png){:width="100%"}\\n\\nSince we wrote our own exploit for CVE-2022-3236 (and \[CVE-2022-1040\](https://nvd.nist.gov/vuln/detail/CVE-2022-1040)), we were curious how many internet-facing Sophos Firewalls might still be vulnerable. We performed a version scan of the servers we identified on Shodan, and found the following results (some low volume hotfixed versions excluded from the graphs due to size):\\n\\n> Sophos Firewalls Using Fixed Versions\\n\\n::bar-chart\\n---\\nlabels:\\n - 18.5.5.509\\n - 19.5.0.197\\n - 19.0.2\\nvalues:\\n - 117\\n - 57\\n - 0\\n---\\n::\\n\\n> Sophos Firewalls Using Versions with a Hotfix Available\\n\\n::bar-chart\\n---\\nlabels:\\n - 18.5.4.418\\n - 18.5.2.380\\n - 18.5.3.408\\n - 18.5.1.326\\n - 18.0.5.586\\n - 18.0.4.506\\n - 17.5.12.664\\n - 17.5.15.746\\n - 18.0.6.655\\n - 17.5.14.714\\n - 17.5.17.837\\n - 17.5.16.830\\n - 19.0.1.365\\n - 18.5.0.264\\n - 18.0.3.457\\n - 17.5.13.692\\nvalues:\\n - 11619\\n - 10466\\n - 9060\\n - 6699\\n - 4045\\n - 3300\\n - 2849\\n - 2866\\n - 2425\\n - 1998\\n - 1713\\n - 1712\\n - 1141\\n - 992\\n - 955\\n - 843\\n---\\n::\\n\\n> Sophos Firewalls Using Vulnerable Versions\\n\\n::bar-chart\\n---\\nlabels:\\n - 17.5.11.661\\n - 17.5.9.577\\n - 17.5.8.539\\n - 17.5.10.620\\n - 18.0.1.396\\n - 17.5.7.511\\n - 17.5.5.433\\n - 17.5.6.488\\n - 17.5.4.429\\n - 18.0.2.403\\n - 18.0.0.379\\n - 18.0.0.354\\n - 18.0.0.339\\n - 18.0.1.367\\n - 17.1.4.254\\n - 18.0.0.321\\n - 18.0.0.285\\n - 18.0.0.180\\n - 17.5.4.409\\nvalues:\\n - 991\\n - 883\\n - 706\\n - 591\\n - 512\\n - 255\\n - 226\\n - 118\\n - 76\\n - 68\\n - 13\\n - 11\\n - 4\\n - 3\\n - 3\\n - 1\\n - 1\\n - 1\\n - 1\\n---\\n::\\n\\nMore than 99% of internet-facing Sophos Firewalls haven't upgraded to versions containing the official fix for CVE-2022-3236. But around 93% are running versions that are eligible for a hotfix, and the default behavior for the firewall is to automatically download and apply hotfixes (unless disabled by an administrator). It’s likely that almost all servers eligible for a hotfix received one, although mistakes do happen. That still leaves more than 4,000 firewalls (or about 6% of internet-facing Sophos Firewalls) running versions that didn’t receive a hotfix and are therefore vulnerable.\\n\\n# Indicators of Compromise\\n\\nThere are firewalls that remain vulnerable to CVE-2022-3236, and the vulnerability was exploited as a 0-day for a period of time. After developing our exploit, we looked for high-quality indicators of compromise. We believe two log files have good indicators of exploitation attempts. The first file is \`/logs/csc.log\`. \\n\\nOur exploit generates the following partially redacted log entry:\\n\\n\`\`\`json\\nMESSAGE Jan 06 12:42:45Z \[worker:15566\]: {\\n "request": {\\n "method": "opcode",\\n "name": "myaccount\_login",\\n "version": "1.6",\\n "type": "json",\\n "length": 441,\\n "data": {\\n "value": REDACTED,\\n "APIVersion": "1805.2",\\n "transactionid": "73",\\n "\_\_\_serverport": 443,\\n "\_\_\_serverip": "10.12.70.202",\\n "\_\_\_component": "GUI",\\n "\_discriminator": REDACTED,\\n "captcha": "d376b3",\\n "username": "txPGiKDy",\\n "mode": 451,\\n "currentlyloggedinuserip": "10.12.70.252",\\n "\_\_\_serverprotocol": "HTTP",\\n "password": "\*\*\*\*"\\n }\\n }\\n}\\n\`\`\`\\n\\nThe presence of the \`\_discriminator\` field in a login request is sufficient to detect an exploit attempt. The other log, \`/log/validationError.log\`, has a similar, but much more verbose indicator.\\n\\n\`\`\`\\n\*\*\*\*\*\*\*\*\*\* Entity json validation log:6-1-2023 7:42:33 Objectname=login::login\\n\\n => Validation start for: password\\n\\n - Validating type : SCALAR,STRING\\n\\n - Validating 'datatype' : Result=true\\n\\n - Validating 'require' : Result=true\\n\\n - Validating 'validateValidAndInvalidInput' for type SCALAR\\n\\n => Validation start for: mode\\n\\n - Validating 'validateValidAndInvalidInput' for type SCALAR\\n\\n => Validation start for: value\\n\\n - Validating 'validateValidAndInvalidInput' for type SCALAR\\n\\n => Validation start for: APIVersion\\n\\n - Validating 'validateValidAndInvalidInput' for type SCALAR\\n\\n => Validation start for: captcha\\n\\n - Validating 'validateValidAndInvalidInput' for type SCALAR\\n\\n => Validation start for: \_\_\_serverip\\n\\n - Validating 'validateValidAndInvalidInput' for type SCALAR\\n\\n => Validation start for: currentlyloggedinuserip\\n\\n - Validating 'validateValidAndInvalidInput' for type SCALAR\\n\\n => Validation start for: username\\n\\n - Validating type : SCALAR,STRING\\n\\n - Validating 'datatype' : Result=true\\n\\n - Validating 'require' : Result=true\\n\\n - Validating 'validateValidAndInvalidInput' for type SCALAR\\n\\n => Validation start for: \_\_\_serverprotocol\\n\\n - Validating 'validateValidAndInvalidInput' for type SCALAR\\n\\n => Validation start for: transactionid\\n\\n - Validating 'validateValidAndInvalidInput' for type SCALAR\\n\\n => Validation start for: \_\_\_serverport\\n\\n - Validating 'validateValidAndInvalidInput' for type SCALAR\\n\\n => Validation start for: \_discriminator\\n\\n - Validating 'validateValidAndInvalidInput' for type SCALAR\\n\\n => Validation start for: \_\_\_component\\n\\n - Validating 'validateValidAndInvalidInput' for type SCALAR\\n\`\`\`\\n\\nAgain, note the presence of the \`\_discriminator\` field within a login request. We encourage Sophos Firewall administrators to look through their logs to determine if they see these indications of an exploit attempt.\\n\\n# Limitations of Exploitation\\n\\nWhile CVE-2022-3236 does allow an attacker to inject and execute arbitrary Perl, there is a limitation to mass exploitation. By default, Sophos Firewall requires web clients to solve a captcha during authentication.\\n\\n!\[captcha\](/blog/sophos-cve-2022-3236/captcha.png){:width="100%"}\\n\\nThe vulnerable code is only reached after the captcha is validated. A failed captcha will result in the exploit failing. While not impossible, programmatically solving captchas is a high hurdle for most attackers. Most internet-facing Sophos Firewalls appear to have the login captcha enabled, which means, even at the most opportune times, this vulnerability was unlikely to have been successfully exploited at scale.\\n\\n# Conclusion\\n\\nCVE-2022-3236 is one of those rare vulnerabilities that has been exploited in the wild with few details ever made public. Having developed an exploit ourselves, we can say this vulnerability was likely never as scary as it sounded thanks to the swift work of Sophos and good default security settings on the firewall itself. Internet-facing firewalls appear to largely be eligible for hotfixes and the default authentication captcha likely prevented mass exploitation.\\n\\nFor more information on vulnerabilities exploited in the wild, register for a VulnCheck account today by loading https://vulncheck.com and clicking “Log In”.\\n

#### [Source](https://vulncheck.com/blog/sophos-cve-2022-3236)

<br/>
---
